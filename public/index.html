<!-- public/index.html -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Socket.IO Chat</title>
    <link rel="stylesheet" href="styles.css"> <!-- Enlazar el archivo CSS -->
</head>

<body>
    <h1>WhatsApp Style Chat</h1>
    <p id="status">Connecting...</p>

    <div id="messages"></div> <!-- Contenedor para mostrar mensajes -->

    <div id="inputContainer">
        <button id="emojiButton">😊</button> <!-- Botón para mostrar emojis -->
        <div id="emojiPicker" class="hidden">
            <span class="emoji">😀</span>
            <span class="emoji">😂</span>
            <span class="emoji">😍</span>
            <span class="emoji">😭</span>
            <span class="emoji">😎</span>
            <span class="emoji">👍</span>
            <span class="emoji">👎</span>
            <span class="emoji">🔥</span>
            <span class="emoji">🎉</span>
            <!-- Añade más emojis según sea necesario -->
        </div>
        <input type="text" id="messageInput" placeholder="Type a message..." />
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        // Obtener el nombre de usuario de la URL
        const urlParams = new URLSearchParams(window.location.search);
        const username = urlParams.get('username');  // Obtener el nombre de usuario desde la URL

        if (!username) {
            document.getElementById('status').innerText = 'Error: No username provided';
            throw new Error('No username provided');
        }

        const socket = io();  // Conectar al servidor de Socket.IO
        const messagesDiv = document.getElementById('messages');
        const emojiButton = document.getElementById('emojiButton');
        const emojiPicker = document.getElementById('emojiPicker');
        const messageInput = document.getElementById('messageInput');

        socket.on('connect', () => {
            document.getElementById('status').innerText = `Connected as: ${username}`;
            console.log('Connected:', socket.id);
        });

        socket.on('disconnect', () => {
            document.getElementById('status').innerText = 'Disconnected';
            console.log('Disconnected');
        });

        socket.on('chatMessage', (data) => {
            console.log('Received message:', data);
            // Crear un elemento de párrafo para el mensaje
            const msgElement = document.createElement('p');
            const now = new Date();
            const time = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            msgElement.innerHTML = `${data.username}: ${data.message} <span class="time">${time}</span>`;

            // Alinear según si el mensaje es del usuario actual o de otro
            if (data.username === username) {
                msgElement.classList.add('self');
            } else {
                msgElement.classList.add('other');
            }

            messagesDiv.appendChild(msgElement);
            messagesDiv.scrollTop = messagesDiv.scrollHeight; // Auto scroll to bottom
        });

        // Enviar mensaje cuando se presiona Enter
        messageInput.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        function sendMessage() {
            const msg = messageInput.value;
            if (msg) {
                socket.emit('chatMessage', { username, message: msg });  // Enviar el mensaje junto con el nombre de usuario
                messageInput.value = '';  // Limpiar el input después de enviar
            }
        }

        // Mostrar/ocultar el picker de emojis
        emojiButton.addEventListener('click', (e) => {
            e.stopPropagation();  // Evitar que se propague el evento click al documento
            emojiPicker.classList.toggle('hidden');  // Usar toggle para mostrar/ocultar
        });

        // Insertar emoji en el campo de texto al hacer clic en uno
        document.querySelectorAll('.emoji').forEach(emoji => {
            emoji.addEventListener('click', () => {
                messageInput.value += emoji.textContent;
                emojiPicker.classList.add('hidden'); // Ocultar picker después de seleccionar un emoji
                messageInput.focus(); // Mantener el foco en el input de texto
            });
        });

        // Ocultar el picker de emojis si se hace clic fuera de él
        document.addEventListener('click', function (event) {
            if (!emojiPicker.contains(event.target) && !emojiButton.contains(event.target)) {
                emojiPicker.classList.add('hidden');  // Ocultar si se hace clic fuera del picker
            }
        });
    </script>



</body>

</html>